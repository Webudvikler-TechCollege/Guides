# Guide til Web Storage i JavaScript üíæ

## Hvad er Web Storage?

**Web Storage** er browserens m√•de at gemme data lokalt p√• din computer. Det er som en miniature database i browseren!

Der findes **to typer** Web Storage:

### 1. **localStorage** 
Gemmer data **permanent** (indtil du sletter det)

### 2. **sessionStorage**
Gemmer data **midlertidigt** (slettes n√•r du lukker fanen/browseren)

---

## Forskellen p√• localStorage og sessionStorage

| Feature | localStorage | sessionStorage |
|---------|-------------|----------------|
| **Levetid** | For evigt | Kun mens fanen er √•ben |
| **Deling mellem faner** | Ja ‚úÖ | Nej ‚ùå |
| **St√∏rrelse** | ~5-10 MB | ~5-10 MB |
| **Bedst til** | Indstillinger, favoritter | Midlertidige data |

**Eksempel:**
```javascript
// localStorage - data overlever browserluk
localStorage.setItem('tema', 'dark')

// sessionStorage - data forsvinder n√•r du lukker fanen
sessionStorage.setItem('s√∏gning', 'pizza')
```

---

## Arbejde med localStorage

### üìù Gemme data

```javascript
// Gem en v√¶rdi
localStorage.setItem('brugernavn', 'Peter')
localStorage.setItem('alder', '23')

// Alternativ syntaks (samme resultat)
localStorage.brugernavn = 'Peter'
localStorage['alder'] = '23'
```

---

### üìñ Hente data

```javascript
// Hent en v√¶rdi
const brugernavn = localStorage.getItem('brugernavn')
console.log(brugernavn) // Output: "Peter"

// Alternativ syntaks
const alder = localStorage.alder
console.log(alder) // Output: "23"

// Hvis n√∏glen ikke findes, f√•r du null
const email = localStorage.getItem('email')
console.log(email) // Output: null
```

---

### üóëÔ∏è Slette data

```javascript
// Slet √©n v√¶rdi
localStorage.removeItem('brugernavn')

// Slet ALLE v√¶rdier
localStorage.clear()
```

---

### üîç Tjekke om en n√∏gle findes

```javascript
// Metode 1: Tjek om getItem returnerer null
if (localStorage.getItem('tema') !== null) {
    console.log('Tema er gemt!')
}

// Metode 2: Brug length til at se antal gemte items
console.log(localStorage.length) // Output: antal gemte n√∏gler
```

---

## Arbejde med sessionStorage

**Pr√¶cis samme API som localStorage!**

```javascript
// Gem data
sessionStorage.setItem('s√∏gning', 'pizza')

// Hent data
const s√∏gning = sessionStorage.getItem('s√∏gning')

// Slet data
sessionStorage.removeItem('s√∏gning')

// Slet alt
sessionStorage.clear()
```

---

## Gemme komplekse data (objekter og arrays)

**Vigtigt:** Storage kan kun gemme **tekst-strenge**!

For objekter og arrays skal du bruge `JSON.stringify()` og `JSON.parse()`

### Gem et objekt

```javascript
const bruger = {
    navn: 'Peter',
    alder: 23,
    by: 'K√∏benhavn'
}

// Konverter til JSON-streng og gem
localStorage.setItem('bruger', JSON.stringify(bruger))
```

### Hent et objekt

```javascript
// Hent JSON-streng og konverter tilbage til objekt
const gemt = localStorage.getItem('bruger')
const bruger = JSON.parse(gemt)

console.log(bruger.navn) // Output: "Peter"
console.log(bruger.alder) // Output: 23
```

### Gem et array

```javascript
const favoritter = ['pizza', 'burger', 'sushi']

// Gem array
localStorage.setItem('favoritter', JSON.stringify(favoritter))

// Hent array
const gemteFavoritter = JSON.parse(localStorage.getItem('favoritter'))
console.log(gemteFavoritter[0]) // Output: "pizza"
```

---

## Praktiske eksempler

### Eksempel 1: Tema-switcher (dark mode)

```javascript
// Indl√¶s gemt tema ved pageload
function loadTheme() {
    const tema = localStorage.getItem('tema') || 'light' // Default: light
    document.body.classList.add(tema)
}

// Skift tema n√•r bruger klikker
function toggleTheme() {
    const body = document.body
    
    if (body.classList.contains('light')) {
        body.classList.remove('light')
        body.classList.add('dark')
        localStorage.setItem('tema', 'dark') // Gem valg
    } else {
        body.classList.remove('dark')
        body.classList.add('light')
        localStorage.setItem('tema', 'light') // Gem valg
    }
}

// K√∏r ved pageload
loadTheme()

// Tilf√∏j til knap
document.querySelector('#tema-knap').addEventListener('click', toggleTheme)
```

---

### Eksempel 2: Huskeliste (Todo-app)

```javascript
// Hent todos fra storage
function getTodos() {
    const todos = localStorage.getItem('todos')
    return todos ? JSON.parse(todos) : [] // Returner array eller tom array
}

// Gem todos i storage
function saveTodos(todos) {
    localStorage.setItem('todos', JSON.stringify(todos))
}

// Tilf√∏j ny todo
function addTodo(tekst) {
    const todos = getTodos()
    todos.push({ id: Date.now(), tekst: tekst, done: false })
    saveTodos(todos)
    renderTodos() // Opdater UI
}

// Slet todo
function deleteTodo(id) {
    const todos = getTodos()
    const filtered = todos.filter(todo => todo.id !== id)
    saveTodos(filtered)
    renderTodos() // Opdater UI
}

// Vis todos p√• siden
function renderTodos() {
    const todos = getTodos()
    const liste = document.querySelector('#todo-liste')
    liste.innerHTML = '' // Ryd liste
    
    todos.forEach(todo => {
        const li = document.createElement('li')
        li.textContent = todo.tekst
        li.onclick = () => deleteTodo(todo.id)
        liste.appendChild(li)
    })
}

// Indl√¶s todos ved pageload
renderTodos()
```

---

### Eksempel 3: Formular med "Husk mig"

```javascript
// Gem formular-data
function saveFormData() {
    const formData = {
        navn: document.querySelector('#navn').value,
        email: document.querySelector('#email').value,
        telefon: document.querySelector('#telefon').value
    }
    localStorage.setItem('formData', JSON.stringify(formData))
}

// Indl√¶s gemt formular-data
function loadFormData() {
    const saved = localStorage.getItem('formData')
    
    if (saved) {
        const data = JSON.parse(saved)
        document.querySelector('#navn').value = data.navn || ''
        document.querySelector('#email').value = data.email || ''
        document.querySelector('#telefon').value = data.telefon || ''
    }
}

// Gem data n√•r bruger skriver
document.querySelector('#navn').addEventListener('input', saveFormData)
document.querySelector('#email').addEventListener('input', saveFormData)
document.querySelector('#telefon').addEventListener('input', saveFormData)

// Indl√¶s ved pageload
loadFormData()

// Ryd data n√•r formular sendes
document.querySelector('form').addEventListener('submit', (e) => {
    e.preventDefault()
    localStorage.removeItem('formData')
    alert('Formular sendt!')
})
```

---

## Hj√¶lpefunktioner (copy-paste venlige)

```javascript
// Gem data (h√•ndterer b√•de strenge og objekter)
function saveToStorage(key, value) {
    const data = typeof value === 'string' ? value : JSON.stringify(value)
    localStorage.setItem(key, data)
}

// Hent data (h√•ndterer b√•de strenge og objekter)
function getFromStorage(key) {
    const data = localStorage.getItem(key)
    if (!data) return null
    
    try {
        return JSON.parse(data) // Pr√∏v at parse som JSON
    } catch {
        return data // Returner som streng hvis det ikke er JSON
    }
}

// Slet data
function removeFromStorage(key) {
    localStorage.removeItem(key)
}

// Tjek om n√∏gle findes
function storageHas(key) {
    return localStorage.getItem(key) !== null
}

// Brug
saveToStorage('bruger', { navn: 'Peter', alder: 23 })
const bruger = getFromStorage('bruger')
console.log(bruger.navn) // Output: "Peter"
```

---

## Loop gennem alle gemte items

```javascript
// Metode 1: key() metoden
for (let i = 0; i < localStorage.length; i++) {
    const key = localStorage.key(i)
    const value = localStorage.getItem(key)
    console.log(`${key}: ${value}`)
}

// Metode 2: Object.keys()
Object.keys(localStorage).forEach(key => {
    console.log(`${key}: ${localStorage[key]}`)
})
```

---

## Storage events (synkroniser mellem faner)

Du kan lytte efter √¶ndringer i storage fra andre faner!

```javascript
// Lyt efter √¶ndringer i localStorage (kun fra ANDRE faner)
window.addEventListener('storage', (e) => {
    console.log(`N√∏gle: ${e.key}`)
    console.log(`Gammel v√¶rdi: ${e.oldValue}`)
    console.log(`Ny v√¶rdi: ${e.newValue}`)
    
    // Eksempel: Opdater tema hvis det √¶ndres i anden fane
    if (e.key === 'tema') {
        document.body.className = e.newValue
    }
})
```

**Vigtigt:** Storage events fyrer kun i **andre faner** - ikke i den fane der lavede √¶ndringen!

---

## Begr√¶nsninger og fejl

### St√∏rrelse
Storage kan gemme **~5-10 MB** afh√¶ngig af browseren.

```javascript
// Tjek om du rammer gr√¶nsen
try {
    localStorage.setItem('storData', 'meget meget lang streng...')
} catch (e) {
    if (e.name === 'QuotaExceededError') {
        alert('Storage er fuld!')
        localStorage.clear() // Ryd plads
    }
}
```

### Private browsing / Incognito mode
Storage kan v√¶re deaktiveret i private vinduer!

```javascript
// Tjek om storage er tilg√¶ngeligt
function isStorageAvailable() {
    try {
        const test = '__storage_test__'
        localStorage.setItem(test, test)
        localStorage.removeItem(test)
        return true
    } catch {
        return false
    }
}

if (!isStorageAvailable()) {
    alert('Storage er ikke tilg√¶ngeligt')
}
```

---

## Storage vs. Cookies

| Feature | Storage | Cookies |
|---------|---------|---------|
| **St√∏rrelse** | ~5-10 MB | ~4 KB |
| **Sendes til server** | Nej | Ja (automatisk) |
| **API** | Simpelt | Besv√¶rligt |
| **Udl√∏ber** | Aldrig (localStorage) | Ja |
| **Bedst til** | Store data, indstillinger | Login-tokens |

**Tommelfingerregel:**
- **localStorage**: Indstillinger, favoritter, cache
- **sessionStorage**: Midlertidige data (formular-data, s√∏gninger)
- **Cookies**: Login-tokens, tracking

---

## Sikkerhed ‚ö†Ô∏è

**Vigtige sikkerhedsregler:**

1. **Gem aldrig passwords eller f√∏lsomme data** - storage er ikke krypteret!
2. **Valider altid data du henter** - nogen kan have manipuleret det
3. **Brug ikke til login-tokens** - brug cookies i stedet
4. **V√¶r obs p√• XSS-angreb** - ondsindet kode kan l√¶se storage

```javascript
// ‚ùå D√ÖRLIGT - Gem aldrig passwords
localStorage.setItem('password', '123456')

// ‚úÖ GODT - Gem kun ikke-f√∏lsomme data
localStorage.setItem('tema', 'dark')
localStorage.setItem('sprog', 'da')
```

---

## Opgaver til at √∏ve dig üí™

### Opgave 1: T√¶ller
Lav en t√¶ller der husker sin v√¶rdi mellem pageloads.

### Opgave 2: Notesapp
Lav en simpel notes-app hvor brugeren kan skrive noter der gemmes lokalt.

### Opgave 3: Indk√∏bsliste
Lav en indk√∏bsliste hvor man kan tilf√∏je, fjerne og markere varer som k√∏bt.

### Opgave 4: Sprog-switcher
Lav en knap der skifter mellem dansk og engelsk, og gem valget.

---

## Debugging tips üêõ

**Se storage i Chrome DevTools:**
1. Tryk `F12`
2. G√• til `Application` tab
3. Udvid `Local Storage` eller `Session Storage` i venstre menu
4. Klik p√• dit website

**Se storage i Firefox:**
1. Tryk `F12`
2. G√• til `Storage` tab
3. Udvid `Local Storage` eller `Session Storage`

**Test i konsollen:**
```javascript
// Se alle gemte items
console.table(localStorage)

// Gem testdata
localStorage.setItem('test', 'hejsa')

// Hent data
console.log(localStorage.getItem('test'))

// Ryd alt
localStorage.clear()
```

---

## Best practices üåü

### 1. Brug namespace til n√∏gler
```javascript
// ‚ùå D√ÖRLIGT - Kan konflikte med andre scripts
localStorage.setItem('user', 'Peter')

// ‚úÖ GODT - Brug app-navn som prefix
localStorage.setItem('minApp_user', 'Peter')
```

### 2. H√•ndter fejl gracefully
```javascript
function safeSetItem(key, value) {
    try {
        localStorage.setItem(key, value)
        return true
    } catch (e) {
        console.error('Kunne ikke gemme i storage:', e)
        return false
    }
}
```

### 3. Brug default-v√¶rdier
```javascript
// ‚ùå D√ÖRLIGT - Kan give fejl hvis key ikke findes
const tema = localStorage.getItem('tema')
document.body.className = tema

// ‚úÖ GODT - Fallback til default
const tema = localStorage.getItem('tema') || 'light'
document.body.className = tema
```

---

## Resurser üìö

- [MDN Web Docs: Web Storage API](https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API)
- [JavaScript.info: LocalStorage](https://javascript.info/localstorage)

**Held og lykke med Web Storage!** üíæ